<!DOCTYPE html>
<html lang="fr">
{% load pwa %}

<head>
  {% load static %}
  {% progressive_web_app_meta %}
  <title>Free Go</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'fridge/css/materialize.min.css' %}" type="text/css">
  <link rel="stylesheet" href="{% static 'fridge/css/style.css' %}" type="text/css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" type="text/css">
  <link rel="stylesheet" href="https://unpkg.com/vuelayers/lib/style.css" type="text/css">

  <!-- JS -->
  <script type="text/javascript" src="{% static 'fridge/js/feather.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'fridge/js/idb.js' %}"></script>
  <script type="text/javascript" src="{% static 'fridge/js/app.js' %}"></script>
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v5.3.0/build/ol.js"></script>
  <script src="https://unpkg.com/vuelayers/lib/index.umd.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>


  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  <!-- NAVBAR HEADER -->
  <header>
    <div id="app-base">
      <div class="navbar-fixed">

        <!-- DROPDOWN STRUCTURE-->
        <ul id="dropdown1" class="dropdown-content">
          <li v-for="notification in notifications" v-bind:key="notification.id">
            <a href="#">[[ notification.verb ]]</a>
          </li>
        </ul>

        <nav class="nav-extended">
          <div class="nav-wrapper">
            <a href="{% url 'fridge:home' %}" class="brand-logo">Free Go</a>
            <ul v-if="notifications.length != 0" class="right">
              <li>
                <a class="dropdown-trigger" href="#!" data-target="dropdown1">
                  [[ notifications.length ]]
                  <i class="material-icons right">notifications</i>
                </a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
    <script>
      var app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app-base',
        data: () => ({
          notifications: [],
          unread_notifications: []
        }),
        mounted() {
          this.getNotifications()
        },
        methods: {
          getNotifications: function () {
            let api_url = "http://127.0.0.1:8000/api/notifications/";
            axios
              .get(api_url)
              .then(response => {
                this.notifications = response.data;
                this.unread_notifications = this.notifications.filter(notification => notification.unread == true);
                console.log(this.unread_notifications);
              })
              .catch(err => {
                console.log(err);
              })
          }
        }
      });
    </script>
  </header>

  <!-- BODY -->
  <main>
    {% block content %}{% endblock %}
  </main>

  <!-- NAVBAR BOTTOM-->
  <footer class="page-footer">
    <ul class="tabs tabs-transparent">
      <li class="tab">
        <a href="{% url 'fridge:home' %}">
          <i class="material-icons" aria-hidden="true">home</i>
        </a>
      </li>
      <li class="tab">
        <!-- TODO FIND ERROR -->
        <a href="fridge/list">
          <i class="material-icons" aria-hidden="true">list</i>
        </a>
      </li>
      <li class="tab">
        <a href="{% url 'fridge:map' %}">
          <i class="material-icons" aria-hidden="true">map</i>
        </a>
      </li>
      <li class="tab">
        <a href="{% url 'fridge:favorite' %}">
          <i class="material-icons" aria-hidden="true">favorite</i>
        </a>
      </li>
      <li class="tab">
        <a href="{% url 'fridge:settings' %}">
          <i class="material-icons" aria-hidden="true">account_circle</i>
        </a>
      </li>
    </ul>
  </footer>

  <!-- JS -->
  <script src="{% static 'fridge/js/jquery-3.5.1.min.js' %}"></script>
  <script src="{% static 'fridge/js/materialize.min.js' %}"></script>
  <script src="{% static 'fridge/js/script.js' %}"></script>
  <script src="{% static 'fridge/js/install.js' %}"></script>

  <script>

    feather.replace()
  </script>

</body>

</html>